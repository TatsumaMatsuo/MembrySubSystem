@tailwind base;
@tailwind components;
@tailwind utilities;

/* フォーム要素のベーススタイル - ダークモード対応 */
@layer base {
  input,
  textarea,
  select {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
  }

  input::placeholder,
  textarea::placeholder {
    color: hsl(var(--muted-foreground));
  }

  input:disabled,
  textarea:disabled,
  select:disabled {
    background-color: hsl(var(--muted));
    color: hsl(var(--muted-foreground));
    opacity: 0.7;
  }

  /* オートフィル時の背景色を維持 */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  textarea:-webkit-autofill,
  textarea:-webkit-autofill:hover,
  textarea:-webkit-autofill:focus,
  select:-webkit-autofill,
  select:-webkit-autofill:hover,
  select:-webkit-autofill:focus {
    -webkit-text-fill-color: hsl(var(--foreground));
    -webkit-box-shadow: 0 0 0px 1000px hsl(var(--background)) inset;
    transition: background-color 5000s ease-in-out 0s;
  }
}

:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 222.2 47.4% 11.2%;
  --primary-foreground: 210 40% 98%;
  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222.2 47.4% 11.2%;
  --muted: 210 40% 96.1%;
  --muted-foreground: 215.4 16.3% 46.9%;
  --accent: 210 40% 96.1%;
  --accent-foreground: 222.2 47.4% 11.2%;
  --border: 214.3 31.8% 91.4%;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
  }
}

body {
  background-color: hsl(var(--background));
  color: hsl(var(--foreground));
}

/* ========================================
   印刷用スタイル - A4縦向け最適化
   ======================================== */
@media print {
  /* ページ設定 */
  @page {
    size: A4 portrait;
    margin: 10mm 5mm;
  }

  /* 印刷時に非表示にする要素 */
  .no-print,
  .print-hide,
  nav,
  aside,
  header:not(.print-header),
  footer:not(.print-footer),
  button:not(.print-show),
  [data-no-print],
  .sidebar,
  .navigation,
  .tab-buttons,
  .refresh-button {
    display: none !important;
  }

  /* 基本スタイル */
  body {
    background: white !important;
    color: black !important;
    font-size: 10pt !important;
    line-height: 1.4 !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* コンテナ幅を最大に */
  .print-container,
  main {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }

  /* 印刷コンテンツエリア */
  .h-full, .h-screen {
    height: auto !important;
  }

  /* カードのシャドウを削除 */
  .shadow-lg,
  .shadow-md,
  .shadow-sm,
  .shadow {
    box-shadow: none !important;
    border: 1px solid #e5e7eb !important;
  }

  /* グラデーション背景を単色に */
  [class*="bg-gradient"] {
    background: #1f2937 !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* テーブルの改ページ制御 */
  table {
    page-break-inside: auto !important;
  }

  tr {
    page-break-inside: avoid !important;
    page-break-after: auto !important;
  }

  thead {
    display: table-header-group !important;
  }

  tfoot {
    display: table-footer-group !important;
  }

  /* グリッドを印刷用に調整 */
  .print-grid-1 {
    grid-template-columns: 1fr !important;
  }

  .print-grid-2 {
    grid-template-columns: 1fr 1fr !important;
  }

  /* グラフコンテナの高さ調整 */
  .recharts-wrapper {
    max-height: 250px !important;
    overflow: visible !important;
  }

  /* グラフ高さ調整 */
  .h-72 {
    height: 220px !important;
  }

  .h-80 {
    height: 240px !important;
  }

  .h-96 {
    height: 280px !important;
  }

  /* Rechartsグラフの印刷対応 */
  .recharts-surface {
    overflow: visible !important;
  }

  .recharts-wrapper svg {
    overflow: visible !important;
  }

  /* ResponsiveContainerの固定サイズ */
  .recharts-responsive-container {
    width: 100% !important;
    min-height: 200px !important;
  }

  /* グラフコンテナの印刷用スケール調整 */
  .bg-white.rounded-xl {
    transform: scale(0.95) !important;
    transform-origin: top left !important;
    margin-bottom: 10px !important;
  }

  /* 印刷ヘッダー */
  .print-header {
    display: block !important;
    text-align: center;
    padding: 8mm 0;
    border-bottom: 2px solid #1f2937;
    margin-bottom: 5mm;
  }

  .print-header h1 {
    font-size: 16pt !important;
    font-weight: bold !important;
    margin: 0 !important;
  }

  .print-header .print-date {
    font-size: 9pt !important;
    color: #666 !important;
    margin-top: 2mm !important;
  }

  /* セクション間のスペース */
  .print-section {
    margin-bottom: 5mm !important;
    page-break-inside: avoid !important;
  }

  /* KPIカードを横並びに */
  .print-kpi-grid {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 3mm !important;
  }

  .print-kpi-card {
    padding: 3mm !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 2mm !important;
    text-align: center !important;
  }

  /* 改ページ制御 */
  .print-break-before {
    page-break-before: always !important;
  }

  .print-break-after {
    page-break-after: always !important;
  }

  .print-avoid-break {
    page-break-inside: avoid !important;
  }

  /* テキストサイズ調整 */
  h1, .text-2xl, .text-3xl {
    font-size: 14pt !important;
  }

  h2, .text-xl {
    font-size: 12pt !important;
  }

  h3, .text-lg {
    font-size: 11pt !important;
  }

  .text-sm, .text-xs {
    font-size: 8pt !important;
  }

  /* リンクのURL非表示 */
  a[href]::after {
    content: none !important;
  }

  /* スクロール領域を展開 */
  .overflow-auto,
  .overflow-x-auto,
  .overflow-y-auto,
  .max-h-\\[500px\\] {
    overflow: visible !important;
    max-height: none !important;
  }
}

/* ========================================
   印刷用スタイル - A4横向け（事業所別）
   @page はJS側で動的に挿入する
   ======================================== */
@media print {
  /* 印刷ボタン非表示 */
  .print-trigger-btn {
    display: none !important;
  }

  body.print-landscape .h-full.flex.flex-col.overflow-hidden {
    height: auto !important;
    overflow: visible !important;
  }

  body.print-landscape .flex-1.flex.overflow-hidden {
    display: block !important;
    overflow: visible !important;
  }

  /* サイドバーを非表示 */
  body.print-landscape .w-48.flex-shrink-0 {
    display: none !important;
  }

  /* ヘッダーバーを非表示 */
  body.print-landscape .flex-shrink-0.bg-white.border-b {
    display: none !important;
  }

  /* メインコンテンツを全幅に */
  body.print-landscape .flex-1.overflow-y-auto.p-6.bg-gray-50 {
    overflow: visible !important;
    padding: 0 !important;
    background: white !important;
  }

  /* 印刷用ヘッダー表示 */
  body.print-landscape .print-landscape-header {
    display: block !important;
    text-align: center;
    padding: 3mm 0;
    border-bottom: 2px solid #1f2937;
    margin-bottom: 4mm;
  }

  body.print-landscape .print-landscape-header h1 {
    font-size: 14pt !important;
    font-weight: bold !important;
    margin: 0 !important;
  }

  body.print-landscape .print-landscape-header .print-meta {
    font-size: 8pt !important;
    color: #666 !important;
    margin-top: 1mm !important;
  }

  /* KPIカードを3列に */
  body.print-landscape .office-kpi-print {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 3mm !important;
    margin-bottom: 4mm !important;
  }

  body.print-landscape .office-kpi-print > div {
    box-shadow: none !important;
    border: 1px solid #d1d5db !important;
    transform: none !important;
    padding: 2mm !important;
  }

  /* 事業所カードを1列全幅で配置（1年分の12ヶ月がきれいに収まる） */
  body.print-landscape .office-print-grid {
    display: block !important;
  }

  body.print-landscape .office-print-grid > div {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    border: 1px solid #d1d5db !important;
    box-shadow: none !important;
    transform: none !important;
    margin-bottom: 3mm !important;
    width: 100% !important;
  }

  /* 事業所カード内のテーブル - A4横全幅で余裕を持たせる */
  body.print-landscape .office-print-grid table {
    font-size: 8pt !important;
    width: 100% !important;
  }

  body.print-landscape .office-print-grid th {
    padding: 1.5px 3px !important;
    font-size: 7.5pt !important;
  }

  body.print-landscape .office-print-grid td {
    padding: 1.5px 3px !important;
  }

  /* 月別セルの最小幅確保（12ヶ月がきれいに並ぶ） */
  body.print-landscape .office-print-grid th.text-center,
  body.print-landscape .office-print-grid td.text-center {
    min-width: 16mm !important;
  }

  /* スパークラインは印刷時非表示（スペース節約） */
  body.print-landscape .office-print-grid .recharts-responsive-container,
  body.print-landscape .office-print-grid .border-t.border-gray-50 {
    display: none !important;
  }

  /* カードヘッダーをコンパクトに */
  body.print-landscape .office-print-grid .p-5.pb-3 {
    padding: 2mm 3mm !important;
  }

  body.print-landscape .office-print-grid .px-5.pb-3 {
    padding: 0 3mm 2mm !important;
  }

  /* カード内 overflow を解除 */
  body.print-landscape .office-print-grid .overflow-x-auto {
    overflow: visible !important;
  }

  /* 構成比バーの色を印刷で維持 */
  body.print-landscape .bg-indigo-400 {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* 種別カラードットの色を印刷で維持 */
  body.print-landscape .office-print-grid span.rounded-full,
  body.print-landscape .office-print-grid span.inline-block {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
}
